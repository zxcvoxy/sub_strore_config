######### é”šç‚¹ start #######

#è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³
p: &p
  type: http
  # è‡ªåŠ¨æ›´æ–°è®¢é˜…æ—¶é—´ï¼Œå•ä½ä¸ºç§’
  interval: 3600
  health-check:
    enable: true
    url: https://cp.cloudflare.com
    interval: 300
    timeout: 1000
    tolerance: 100

rule-anchor:
  ip: &ip { type: http, interval: 86400, behavior: ipcidr, format: yaml }
  domain:
    &domain { type: http, interval: 86400, behavior: domain, format: yaml }
  classical:
    &classical { type: http, interval: 86400, behavior: classical, format: yaml }

######### é”šç‚¹ end #######

# url é‡Œå¡«å†™è‡ªå·±çš„è®¢é˜…,åç§°ä¸èƒ½é‡å¤
proxy-providers:
  provider1:
    <<: *p
    url: ""
    

mode: rule
log-level: debug # æ—¥å¿—ç­‰çº§ silent/error/warning/info/debug
ipv6: true # å¼€å¯ IPv6 æ€»å¼€å…³ï¼Œå…³é—­é˜»æ–­æ‰€æœ‰ IPv6 é“¾æ¥å’Œå±è”½ DNS è¯·æ±‚ AAAA è®°å½•
mixed-port: 7890 # HTTP(S) å’Œ SOCKS ä»£ç†æ··åˆç«¯å£
allow-lan: true # å…è®¸å±€åŸŸç½‘è¿æ¥
unified-delay: true # æ›´æ¢å»¶è¿Ÿè®¡ç®—æ–¹å¼,å»é™¤æ¡æ‰‹ç­‰é¢å¤–å»¶è¿Ÿ
tcp-concurrent: true # TCP å¹¶å‘è¿æ¥æ‰€æœ‰ IP, å°†ä½¿ç”¨æœ€å¿«æ¡æ‰‹çš„ TCP
global-client-fingerprint: random # å…¨å±€å®¢æˆ·ç«¯æŒ‡çº¹ random éšæœºæŒ‡çº¹

#  find-process-mode has 3 values:always, strict, off
#  - always, å¼€å¯ï¼Œå¼ºåˆ¶åŒ¹é…æ‰€æœ‰è¿›ç¨‹
#  - strict, é»˜è®¤ï¼Œç”± mihomo åˆ¤æ–­æ˜¯å¦å¼€å¯
#  - off, ä¸åŒ¹é…è¿›ç¨‹ï¼Œæ¨èåœ¨è·¯ç”±å™¨ä¸Šä½¿ç”¨æ­¤æ¨¡å¼
find-process-mode: strict

# ç¼“å­˜
profile: 
  store-selected: true # å­˜å‚¨ select é€‰æ‹©è®°å½•
  store-fake-ip: true # æŒä¹…åŒ– fake-ip

# è‡ªåŠ¨åŒæ­¥æ—¶é—´ä»¥é˜²æ­¢æ—¶é—´ä¸å‡†å¯¼è‡´æ— æ³•æ­£å¸¸è”ç½‘
ntp:
  enable: true
  write-to-system: false
  server: time.apple.com
  port: 123
  interval: 30

# å¤–éƒ¨æ§åˆ¶ç«¯å£
# external-controller: 0.0.0.0:9090 # RESTful API ç›‘å¬åœ°å€
# secret: ""
# external-ui-url: "https://github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip"

geodata-mode: true # GEOIP æ•°æ®æ¨¡å¼
geo-auto-update: true # æ˜¯å¦è‡ªåŠ¨æ›´æ–° geodata
geo-update-interval: 24 # æ›´æ–°é—´éš”ï¼Œå•ä½ï¼šå°æ—¶
# geox-url:
#   geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
#   geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
#   mmdb: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.metadb"
geox-url:
  geosite: https://ghfast.top/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat
  mmdb: https://ghfast.top/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.metadb
  geoip: https://cdn.jsdelivr.net/gh/Loyalsoldier/geoip@release/geoip.dat
  asn: https://cdn.jsdelivr.net/gh/Loyalsoldier/geoip@release/GeoLite2-ASN.mmdb

# TCP Keep Alive è®¾ç½®
keep-alive-interval: 1800 # TCP Keep Alive åŒ…çš„é—´éš”ï¼Œå•ä½ä¸ºç§’ï¼Œ ç¼“è§£ç§»åŠ¨è®¾å¤‡è€—ç”µé—®é¢˜

# åŸŸåå—…æ¢
sniffer:
  enable: true
  sniff: # TLS å’Œ QUIC é»˜è®¤å¦‚æœä¸é…ç½® ports é»˜è®¤å—…æ¢ 443
    QUIC:
      ports: [443]
    TLS:
      ports: [443, 8443]
    HTTP: 
      ports: [80, 8080-8880]
      override-destination: true

# Tun é…ç½®
tun:
  enable: true
  stack: mixed # gvisor/mixed
  dns-hijack:
    - 'any:53'
    - 'tcp://any:53'
  auto-detect-interface: true # è‡ªåŠ¨è¯†åˆ«å‡ºå£ç½‘å¡
  auto-route: true # é…ç½®è·¯ç”±è¡¨
  strict-route: true # å°†æ‰€æœ‰è¿æ¥è·¯ç”±åˆ° tun æ¥é˜²æ­¢æ³„æ¼ï¼Œä½†ä½ çš„è®¾å¤‡å°†æ— æ³•å…¶ä»–è®¾å¤‡è¢«è®¿é—®
  inet4-route-address: 
    - 0.0.0.0/1
    - 128.0.0.0/1
  inet6-route-address: 
    - "::/1"
    - "8000::/1"

# DNS é…ç½®
dns:
  enable: true  # å…³é—­å°†ä½¿ç”¨ç³»ç»Ÿ DNS
  # å¼€å¯ DOH çš„ http/3
  # prefer-h3: true
  listen: 0.0.0.0:53
  ipv6: true
  ipv6-timeout: 300 
  respect-rules: true # dns è¿æ¥éµå®ˆè·¯ç”±è§„åˆ™, ä¸å»ºè®®å’Œ prefer-h3 ä¸€èµ·ä½¿ç”¨
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - 'geosite:connectivity-check'
    - 'geosite:private'
  default-nameserver:
    - 223.5.5.5
  proxy-server-nameserver:
    - 223.5.5.5
  direct-nameserver:
    - system
    - https://doh.pub/dns-query
    - https://223.5.5.5/dns-query
    - https://doh.360.cn/dns-query
  nameserver:
    - 'https://8.8.8.8/dns-query#ecs=120.76.0.0/14&ecs-override=true'
    - 'https://1.1.1.1/dns-query#ecs=120.76.0.0/14&ecs-override=true'
  nameserver-policy:
    "geosite:cn,private,category-game-accelerator-cn,category-games,apple,apple-cn":
      - 223.5.5.5
      - tls://223.5.5.5:853
      - tls://119.29.29.29:853
      - tls://dot.360.cn:853

proxies:
  - name: "ç›´è¿"
    type: direct
    udp: true

proxy-groups:
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies:
      - ç›´è¿
      - è‡ªåŠ¨é€‰æ‹©
      - é¦™æ¸¯
      - å°æ¹¾
      - æ—¥æœ¬
      - æ–°åŠ å¡
      - ç¾å›½
      - å…¶å®ƒåœ°åŒº
      - provider1-group

  - name: provider1-group
    type: select
    use:
      - provider1

  - name: ğŸ¯ å…¨çƒç›´è¿
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  - name: ğŸ›‘ å…¨çƒæ‹¦æˆª
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT

  #åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - name: è‡ªåŠ¨é€‰æ‹©
    type: url-test
    include-all-providers: true
    tolerance: 10

  - name: é¦™æ¸¯
    type: url-test
    include-all-providers: true
    filter: "(?i)æ¸¯|hk|hongkong|hong kong"
    tolerance: 150
    lazy: true
    url: 'http://www.gstatic.com/generate_204'
    interval: 120

  - name: å°æ¹¾
    type: url-test
    include-all-providers: true
    filter: "(?i)å°|tw|taiwan"
    tolerance: 150
    lazy: true
    url: 'http://www.gstatic.com/generate_204'
    interval: 120

  - name: æ—¥æœ¬
    type: url-test
    include-all-providers: true
    filter: "(?i)æ—¥|jp|japan"
    tolerance: 150
    lazy: true
    url: 'http://www.gstatic.com/generate_204'
    interval: 120

  - name: ç¾å›½
    type: url-test
    include-all-providers: true
    filter: "(?i)ç¾|us|unitedstates|united states"
    tolerance: 150
    lazy: true
    url: 'http://www.gstatic.com/generate_204'
    interval: 120

  - name: æ–°åŠ å¡
    type: url-test
    include-all-providers: true
    filter: "(?i)(æ–°|sg|singapore)"
    tolerance: 150
    lazy: true
    url: 'http://www.gstatic.com/generate_204'
    interval: 120

  - name: å…¶å®ƒåœ°åŒº
    type: url-test
    include-all-providers: true
    filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"
    tolerance: 150
    lazy: true
    url: 'http://www.gstatic.com/generate_204'
    interval: 120

# è§„åˆ™
rules:
  - DOMAIN-SUFFIX,googleapis.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - DOMAIN-SUFFIX,googleapis.cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - DOMAIN-SUFFIX,xn--ngstr-lra8j.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹© # Google Play å›½å¤–/å›½å†… æœåŠ¡å™¨
  - DOMAIN-SUFFIX,xn--ngstr-cn-8za9o.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹© # Google Play çº¯å›½å†… æœåŠ¡å™¨

  # åŸŸåè§„åˆ™
  - RULE-SET,cn,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,category-games@cn,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,collection,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,proxy,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,geolocation-!cn@cn,ğŸ¯ å…¨çƒç›´è¿
  - GEOSITE,geolocation-!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,geolocation-cn@!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,geolocation-cn,ğŸ¯ å…¨çƒç›´è¿
  - GEOSITE,CN,ğŸ¯ å…¨çƒç›´è¿
  
  - GEOIP,telegram,PROXY,no-resolve
  - GEOIP,lan,DIRECT
  - GEOIP,cn,DIRECT
  - RULE-SET,cn-ip,DIRECT
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

rule-providers:
  collection:
    <<: *classical
    url: "https://gist.githubusercontent.com/cnfree8964/0864fd1d2e88936a095fb40d74ce4993/raw/collection.yaml"
  cn:
    <<: *classical
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/classical/cn.yaml"
  category-games@cn:
    <<: *classical
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/classical/category-games@cn.yaml"
  proxy:
    <<: *classical
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo-lite/geosite/classical/proxy.yaml"

  cn-ip:
    <<: *classical
    url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/classical/cn.yaml"
