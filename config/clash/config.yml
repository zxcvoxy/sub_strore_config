# clash æ–‡æ¡£
# https://dreamacro.github.io/clash/zh_CN/
#
# å‚è€ƒé…ç½®ï¼š
# https://gist.github.com/miaomiaoclub/6947f7cb93846301f1658da0edcd61bf

# HTTP(S) and SOCKS5 å…±ç”¨ç«¯å£
mixed-port: 7890
allow-lan: true
# è§„åˆ™æ¨¡å¼ï¼šRuleï¼ˆè§„åˆ™ï¼‰ / Globalï¼ˆå…¨å±€ä»£ç†ï¼‰/ Directï¼ˆå…¨å±€ç›´è¿ï¼‰
mode: rule
# 5 ä¸ªçº§åˆ«ï¼šsilent / info / warning / error / debug
log-level: info


# RESTful Web API ç›‘å¬åœ°å€
external-controller: 127.0.0.1:9090

# é…ç½®ç›®å½•çš„ç›¸å¯¹è·¯å¾„æˆ–é™æ€ Web èµ„æºç›®å½•çš„ç»å¯¹è·¯å¾„. Clash core å°†åœ¨
# `http://{{external-controller}}/ui` ä¸­æä¾›æœåŠ¡.
# external-ui: folder

# RESTful API å¯†é’¥ (å¯é€‰)
# é€šè¿‡æŒ‡å®š HTTP å¤´ `Authorization: Bearer ${secret}` è¿›è¡Œèº«ä»½éªŒè¯
# å¦‚æœRESTful APIåœ¨ 0.0.0.0 ä¸Šç›‘å¬, åŠ¡å¿…è®¾ç½®ä¸€ä¸ª secret å¯†é’¥.
secret: "111111"

# æœ¬åœ° SOCKS5/HTTP(S) ä»£ç†æœåŠ¡çš„è®¤è¯
# authentication:
#  - "admin:pass1"

# DNSæœåŠ¡å™¨è®¾ç½®
# å¦‚æœä¸è®¾ç½®ï¼ŒDNSæœåŠ¡å™¨å°†è¢«ç¦ç”¨ã€‚
# å‚è€ƒ https://sakanoy.com/2021/06/23/ClashX%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/
dns:
  enable: true
  ipv6: true
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16 # Fake IP åœ°å€æ±  CIDR
  # ä¸ä½¿ç”¨fakeipè§£æï¼Œè¿”å›çœŸå®ip
  fake-ip-filter:
    # === LAN ===
    - '*.lan'
    ## QQ Quick Login
    - localhost.ptlogin2.qq.com
  default-nameserver:
    - 114.114.114.114 #114dns
    - 119.29.29.29 #è…¾è®¯äº‘
    - 223.5.5.5 # é˜¿é‡Œäº‘ 
    - 185.222.222.222 #DNS.SB
    - 9.9.9.9 #IBM-Quad9
    - 1.1.1.1 #Cloudflare
    - 1.0.0.1 #Cloudflare
    - 8.8.8.8 #Google
    - 101.101.101.101 #TWNIC-Quad101
  # æ”¯æŒ UDP, TCP, DoT, DoH. å’ŒæŒ‡å®šç«¯å£
  nameserver:
    - tls://dns.pub #è…¾è®¯äº‘
    - https://doh.pub/dns-query #è…¾è®¯äº‘
    - https://dns.alidns.com/dns-query #é˜¿é‡Œäº‘
    - https://rubyfish.cn/dns-query #çº¢é±¼
    - https://doh.360.cn/dns-query #360
    - https://doh.sb/dns-query #DNS.SB
    - https://doh-jp.blahdns.com/dns-query #blahdns
    - https://doh-de.blahdns.com/dns-query #blahdns
  fallback:
    - tls://1.1.1.1:853 # cloudflare DNS over TLS
    - tls://8.8.8.8:853 # Google DNS over TLS
    - tls://8.8.4.4:853 
    - https://1.1.1.1/dns-query # cloudflare DNS over HTTPS
    - https://1.0.0.1/dns-query
    - https://dns.google/dns-query # Google DNS over HTTPS
    - https://dns.twnic.tw/dns-query #Quad 101
    - https://dns.adguard.com/dns-query #AdGuard
    - https://dns.quad9.net/dns-query #IBM-Quad9
    - https://doh.opendns.com/dns-query #OpenDNS
  fallback-filter:
    geoip: true
    geoip-code: CN
    # è¿™äº›å­ç½‘ipè§†ä¸ºæ±¡æŸ“ipï¼Œå¦‚æœnameserverçš„ç»“æœä¸ºè¿™äº›ï¼Œåˆ™ä½¿ç”¨fallbackçš„ç»“æœ
    ipcidr:
      - 0.0.0.0/8
      - 10.0.0.0/8
      - 100.64.0.0/10
      - 127.0.0.0/8
      - 169.254.0.0/16
      - 172.16.0.0/12
      - 192.0.0.0/24
      - 192.0.2.0/24
      - 192.88.99.0/24
      - 192.168.0.0/16
      - 198.18.0.0/15
      - 198.51.100.0/24
      - 203.0.113.0/24
      - 224.0.0.0/4
      - 240.0.0.0/4
      - 255.255.255.255/32
    # è¢«æ±¡æŸ“çš„åŸŸåï¼Œå¦‚æœæŸ¥æ‰¾çš„åŸŸåä¸ºè¿™äº›ï¼Œåˆ™ä½¿ç”¨fallbackçš„ç»“æœ
    domain:
      - '+.google.com'
      - '+.youtube.com'

# tun:
#   enable: true
#   # system / gvisor
#   # å¥½åƒä»… Linuxã€macOS æˆ– Android ä¸‹å¯ä»¥ä½¿ç”¨system 
#   stack: gvisor
#   auto-route: true # è‡ªåŠ¨è®¾ç½® Windows çš„å…¨å±€è·¯ç”±ï¼Œ ç®¡ç† `ip route` å’Œ `ip rules`
#   auto-redir: true # ç®¡ç† nftable REDIRECT
#   auto-detect-interface: true # è‡ªåŠ¨æ£€æµ‹æ¥å£ ä¸ `interface-name`é…ç½® å†²çª
#   dns-hijack:
#     - 198.18.0.2:53 # å½“ `fake-ip-range` æ˜¯ 198.18.0.1/16 æ—¶ï¼Œåº”åŠ«æŒ 198.18.0.2:53
#     # - 8.8.8.8:53
#     # - tcp://8.8.8.8:53
#     # - any:53
#     # - tcp://any:53


# urlè®¢é˜…é“¾æ¥, è®¢é˜…æ–‡ä»¶åº”å½“ä¸º yaml æ ¼å¼, å¦åˆ™åº”å½“è¿›è¡Œè®¢é˜…è½¬æ¢
proxy-providers:
  proxy-pro:
    type: http
    url: https%3A%2F%2Fchiguayun.com%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3D55af3d4498fdc707d4cf331e498e5554&target=clash
    path: ./proxy/proxy.yml
    interval: 86400
    health-check:
      enable: true
      interval: 600
      url: https://www.gstatic.com/generate_204

proxy-groups:
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies:
      - DIRECT

  # ç­–ç•¥ç»„
  - name: ğŸ¯ å…¨çƒç›´è¿
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  - name: ğŸ›‘ å…¨çƒæ‹¦æˆª
    type: select
    proxies:
      - REJECT
      - DIRECT

  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - ğŸ¯ å…¨çƒç›´è¿

# clash-rulesé¡¹ç›®æä¾›çš„è§„åˆ™é›†
# https://github.com/Loyalsoldier/clash-rules
#
# é‡åˆ°æ— æ³•è®¿é—®çš„æƒ…å†µå¯ä»¥ä½¿ç”¨ github ä»£ç†åœ°å€
# https://ghproxy.com/*
rule-providers:
  steam:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Providers/Ruleset/Steam.yaml"
    path: ./ruleset/Steam.yaml
    interval: 86400

  # ACL4SSR å¸¸è§å¹¿å‘Šå…³é”®å­—
  banad:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Providers/BanAD.yaml"
    path: ./ruleset/BanAD.yaml
    interval: 86400

  # iCloud åŸŸååˆ—è¡¨
  icloud:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/icloud.txt"
    path: ./ruleset/icloud.yaml
    interval: 86400

  # Apple åœ¨ä¸­å›½å¤§é™†å¯ç›´è¿çš„åŸŸååˆ—è¡¨
  apple:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/apple.txt"
    path: ./ruleset/apple.yaml
    interval: 86400

  # [æ…ç”¨]Google åœ¨ä¸­å›½å¤§é™†å¯ç›´è¿çš„åŸŸååˆ—è¡¨ 
  google:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/google.txt"
    path: ./ruleset/google.yaml
    interval: 86400

  # ä»£ç†åŸŸååˆ—è¡¨
  proxy:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/proxy.txt"
    path: ./ruleset/proxy.yaml
    interval: 86400

  # ç›´è¿åŸŸååˆ—è¡¨
  direct:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/direct.txt"
    path: ./ruleset/direct.yaml
    interval: 86400

  # ç§æœ‰ç½‘ç»œä¸“ç”¨åŸŸååˆ—è¡¨
  private:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/private.txt"
    path: ./ruleset/private.yaml
    interval: 86400

  # GFWList åŸŸååˆ—è¡¨
  gfw:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/gfw.txt"
    path: ./ruleset/gfw.yaml
    interval: 86400

  # éä¸­å›½å¤§é™†ä½¿ç”¨çš„é¡¶çº§åŸŸååˆ—è¡¨ tld-not-cn
  tld-not-cn:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/tld-not-cn.txt"
    path: ./ruleset/tld-not-cn.yaml
    interval: 86400

  # Telegram ä½¿ç”¨çš„ IP åœ°å€åˆ—è¡¨
  telegramcidr:
    type: http
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/telegramcidr.txt"
    path: ./ruleset/telegramcidr.yaml
    interval: 86400

  # ä¸­å›½å¤§é™† IP åœ°å€åˆ—è¡¨
  cncidr:
    type: http
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/cncidr.txt"
    path: ./ruleset/cncidr.yaml
    interval: 86400

  # å±€åŸŸç½‘ IP åŠä¿ç•™ IP åœ°å€åˆ—è¡¨
  lancidr:
    type: http
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/lancidr.txt"
    path: ./ruleset/lancidr.yaml
    interval: 86400

  # éœ€è¦ç›´è¿çš„å¸¸è§è½¯ä»¶åˆ—è¡¨
  applications:
    type: http
    behavior: classical
    url: "https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/applications.txt"
    path: ./ruleset/applications.yaml
    interval: 86400

rules:
  # DOMAIN-SUFFIXï¼šåŸŸååç¼€åŒ¹é…
  # DOMAIN-KEYWORDï¼šåŸŸåå…³é”®å­—åŒ¹é…
  #
  # IP-CIDRï¼šIP æ®µåŒ¹é…
  # GEOIP : é€šè¿‡è§£æçš„ ip æ‰€å±åœ°è¿›è¡Œåˆ†æµã€‚
  # MATCH : å…¨åŒ¹é… , ä¸€èˆ¬æ”¾åœ¨æœ€å
  
  - DOMAIN-SUFFIX,tttttttt.xx,ğŸ¯ å…¨çƒç›´è¿

  # éœ€è¦ç›´è¿çš„è§„åˆ™é›†
  - RULE-SET,lancidr,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,applications,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,private,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,icloud,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,apple,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,google,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,direct,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,cncidr,ğŸ¯ å…¨çƒç›´è¿

  # å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,banad,ğŸ›‘ å…¨çƒæ‹¦æˆª

  # ä»£ç† é›†
  - RULE-SET,proxy,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,tld-not-cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,gfw,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,telegramcidr,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,steam,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # LAN
  - GEOIP,LAN,DIRECT
  
  # æœ€ååŒ¹é…
  - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
  
